import unittest
import os

from vulnerability_gap.c10 import C10_HTMLComment

class TestC10(unittest.TestCase):
    def test_get_requests(self):
        seed_path = "./resources/seed.html"
        modified_seed_path = "./resources/modified/C10_modified_seed.html"
        headers, encoder = C10_HTMLComment.get_requests()

        self.assertEqual(headers["Connection"], "keep-alive")
        self.assertEqual(headers["User-Agent"], os.getenv("USER_AGENT"))
        self.assertEqual(headers["Content-Type"], encoder.content_type)

        self.assertTrue(os.path.exists(modified_seed_path))
        with open(modified_seed_path, "r") as modified_seed:
            with open(seed_path, "r") as seed:
                self.assertEqual(modified_seed.read(), "<!--" + "#"*4096 + "-->" + seed.read())
                seed.close()
            modified_seed.close()

        encoder.fields["image"][1].close()

if __name__ == '__main__':
    unittest.main()