import unittest
import os

from vulnerability_gap.c2 import C2_XSS

class TestC2(unittest.TestCase):
    def test_get_requests(self):
        headers, encoder = C2_XSS.get_requests()
        
        self.assertEqual(headers["Connection"], "keep-alive")
        self.assertEqual(headers["User-Agent"], os.getenv("USER_AGENT"))
        self.assertEqual(headers["Content-Type"], encoder.content_type)

        self.assertEqual(len(encoder.fields), 2)
        self.assertEqual(encoder.fields["image"][0], "XSS&#60img src=”” onerror=alert(XSS)&#62test.png")

        encoder.fields["image"][1].close()

if __name__ == '__main__':
    unittest.main()