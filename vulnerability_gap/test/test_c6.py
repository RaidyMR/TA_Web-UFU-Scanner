import unittest
import os

from vulnerability_gap.c6 import C6_FileExtension

class TestC6(unittest.TestCase):
    def test_get_requests(self):
        encoders = []
        headers = []
        filenames = [
            "seed.html.png",
            "seed.html;png",
            "seed.html.aabbcc",
            "seed.shtml",
            "seed.phtml",
            "seed.hTml",
            "seed.html...........",
            "seed.html%00.png",
            "seed.php3",
            "seed.php4",
            "seed.ufu"
            "seed"
        ]
        

        for filename in filenames:
            header, encoder = C6_FileExtension.get_requests(filename)
            headers.append(header)
            encoders.append(encoder)

        for i in range(len(filenames)):
            self.assertEqual(headers[i]["Connection"], "keep-alive")
            self.assertEqual(headers[i]["User-Agent"], os.getenv("USER_AGENT"))
            self.assertEqual(headers[i]["Content-Type"], encoders[i].content_type)

            self.assertEqual(len(encoders[i].fields), 2)
            self.assertEqual(encoders[i].fields["image"][0], filenames[i])

            encoders[i].fields["image"][1].close()

if __name__ == '__main__':
    unittest.main()