import unittest
import os

from utils.request import get_request
from vulnerability_gap.vg5 import VG5_ContentType

class TestVG5(unittest.TestCase):
    def test_modify_headers(self):
        headers, encoder = get_request()
        modified_headers = VG5_ContentType.modify_headers(headers)

        self.assertEqual(modified_headers["Connection"], "keep-alive")
        self.assertEqual(modified_headers["User-Agent"], os.getenv("USER_AGENT"))
        self.assertEqual(modified_headers["Content-Type"], 'image/png')

        self.assertEqual(len(encoder.fields), 2)
        self.assertEqual(encoder.fields["image"][0], "seed.html")

        encoder.fields["image"][1].close()

if __name__ == '__main__':
    unittest.main()