import requests

from utils.request import get_request
from utils.utils import is_vulnerable

class VG5_ContentType:
    def execute(file_upload_url):
        headers, encoder = get_request()
        modified_headers = VG5_ContentType.modify_headers(headers)

        response = requests.post(file_upload_url, data=encoder, headers=modified_headers)
        status = "Vulnerable" if is_vulnerable(response.text, response.status_code) else "Not Vulnerable"
        
        encoder.fields["image"][1].close()

        return {
            "ID": "VG5",
            "Name": "Modify Content-Type",
            "Score": "6.3",
            "Severity": "Medium",
            "Status": status,
        }
    
    def modify_headers(headers):
        headers["Content-Type"] = "image/png"
        return headers